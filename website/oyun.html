<!DOCTYPE html>
<html lang="tr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>≈ûekil E≈üle≈ütirme Oyunu V4.0</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>

    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Framer Motion -->
    <script src="https://unpkg.com/framer-motion@10.16.4/dist/framer-motion.js"></script>

    <!-- Canvas Confetti -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    <style>
        /* Prevent Pull-to-Refresh and Zoom on Touch Devices */
        * {
            touch-action: manipulation;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            overscroll-behavior-y: contain;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            overflow: hidden;
        }

        /* Flat Shape Shadows (No borders) */
        .shape-shadow {
            filter: drop-shadow(0 8px 16px rgba(0, 0, 0, 0.15));
        }

        /* Shake Animation Keyframes */
        @keyframes shake {

            0%,
            100% {
                transform: translateX(0);
            }

            10%,
            30%,
            50%,
            70%,
            90% {
                transform: translateX(-12px);
            }

            20%,
            40%,
            60%,
            80% {
                transform: translateX(12px);
            }
        }

        .shake-animation {
            animation: shake 0.5s ease-in-out;
        }
    </style>
</head>

<body class="bg-gradient-to-br from-sky-100 via-indigo-50 to-purple-100 overflow-hidden select-none">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useCallback } = React;
        const { motion, AnimatePresence } = window.Motion;

        // --- Audio Context for Sound Synthesis ---
        let audioContext = null;

        const initAudioContext = () => {
            if (!audioContext) {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
            }
            if (audioContext.state === 'suspended') {
                audioContext.resume();
            }
            return audioContext;
        };

        // Correct Sound: High-pitched "Ding" (Sine Wave)
        const playCorrectSound = () => {
            const ctx = initAudioContext();
            const oscillator = ctx.createOscillator();
            const gainNode = ctx.createGain();

            oscillator.type = 'sine';
            oscillator.frequency.setValueAtTime(880, ctx.currentTime);
            oscillator.frequency.exponentialRampToValueAtTime(1320, ctx.currentTime + 0.1);

            gainNode.gain.setValueAtTime(0.4, ctx.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.4);

            oscillator.connect(gainNode);
            gainNode.connect(ctx.destination);

            oscillator.start(ctx.currentTime);
            oscillator.stop(ctx.currentTime + 0.4);
        };

        // Wrong Sound: Low-pitched "Bop" (Triangle Wave)
        const playWrongSound = () => {
            const ctx = initAudioContext();
            const oscillator = ctx.createOscillator();
            const gainNode = ctx.createGain();

            oscillator.type = 'triangle';
            oscillator.frequency.setValueAtTime(150, ctx.currentTime);
            oscillator.frequency.exponentialRampToValueAtTime(80, ctx.currentTime + 0.15);

            gainNode.gain.setValueAtTime(0.5, ctx.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.2);

            oscillator.connect(gainNode);
            gainNode.connect(ctx.destination);

            oscillator.start(ctx.currentTime);
            oscillator.stop(ctx.currentTime + 0.2);
        };

        // Start Game Sound: Rising chime
        const playStartSound = () => {
            const ctx = initAudioContext();
            const notes = [523, 659, 784]; // C5, E5, G5

            notes.forEach((freq, i) => {
                const oscillator = ctx.createOscillator();
                const gainNode = ctx.createGain();

                oscillator.type = 'sine';
                oscillator.frequency.setValueAtTime(freq, ctx.currentTime + i * 0.15);

                gainNode.gain.setValueAtTime(0, ctx.currentTime + i * 0.15);
                gainNode.gain.linearRampToValueAtTime(0.3, ctx.currentTime + i * 0.15 + 0.05);
                gainNode.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + i * 0.15 + 0.3);

                oscillator.connect(gainNode);
                gainNode.connect(ctx.destination);

                oscillator.start(ctx.currentTime + i * 0.15);
                oscillator.stop(ctx.currentTime + i * 0.15 + 0.3);
            });
        };

        // Text-to-Speech for Turkish Instructions
        const speakInstruction = (shapeName) => {
            if ('speechSynthesis' in window) {
                window.speechSynthesis.cancel();

                const utterance = new SpeechSynthesisUtterance(`${shapeName} Bul`);
                utterance.lang = 'tr-TR';
                utterance.rate = 0.9;
                utterance.pitch = 1.1;
                utterance.volume = 1;

                setTimeout(() => {
                    window.speechSynthesis.speak(utterance);
                }, 100);
            }
        };

        // --- Game Data & Config ---
        const SHAPES = [
            { id: 'kare', name: 'KARE', displayName: 'Kareyi', color: 'bg-orange-400', type: 'rounded-3xl' },
            { id: 'daire', name: 'DAƒ∞RE', displayName: 'Daireyi', color: 'bg-sky-400', type: 'rounded-full' },
            { id: 'ucgen', name: '√ú√áGEN', displayName: '√ú√ßgeni', color: 'bg-rose-400', clipPath: 'polygon(50% 0%, 0% 100%, 100% 100%)' },
            { id: 'yildiz', name: 'YILDIZ', displayName: 'Yƒ±ldƒ±zƒ±', color: 'bg-amber-400', clipPath: 'polygon(50% 0%, 61% 35%, 98% 35%, 68% 57%, 79% 91%, 50% 70%, 21% 91%, 32% 57%, 2% 35%, 39% 35%)' },
            { id: 'dikdortgen', name: 'Dƒ∞KD√ñRTGEN', displayName: 'Dikd√∂rtgeni', color: 'bg-violet-400', type: 'rounded-2xl', isWide: true },
            { id: 'besgen', name: 'BE≈ûGEN', displayName: 'Be≈ügeni', color: 'bg-emerald-400', clipPath: 'polygon(50% 0%, 100% 38%, 82% 100%, 18% 100%, 0% 38%)' },
        ];

        const TOTAL_LEVELS = 10;

        // --- Components ---

        // Start Screen Component
        const StartScreen = ({ onStart }) => {
            return (
                <div className="flex flex-col items-center justify-center h-screen">
                    <motion.div
                        initial={{ scale: 0.8, opacity: 0 }}
                        animate={{ scale: 1, opacity: 1 }}
                        transition={{ type: "spring", stiffness: 200, damping: 20 }}
                        className="text-center"
                    >
                        {/* Decorative Shapes */}
                        <div className="flex justify-center gap-6 mb-8">
                            <motion.div
                                animate={{ y: [0, -10, 0] }}
                                transition={{ repeat: Infinity, duration: 2, delay: 0 }}
                                className="w-16 h-16 bg-orange-400 rounded-xl shape-shadow"
                            />
                            <motion.div
                                animate={{ y: [0, -10, 0] }}
                                transition={{ repeat: Infinity, duration: 2, delay: 0.3 }}
                                className="w-16 h-16 bg-sky-400 rounded-full shape-shadow"
                            />
                            <motion.div
                                animate={{ y: [0, -10, 0] }}
                                transition={{ repeat: Infinity, duration: 2, delay: 0.6 }}
                                className="w-16 h-16 bg-rose-400 shape-shadow"
                                style={{ clipPath: 'polygon(50% 0%, 0% 100%, 100% 100%)' }}
                            />
                        </div>

                        <h1 className="text-5xl lg:text-7xl font-black text-transparent bg-clip-text bg-gradient-to-r from-purple-600 via-pink-500 to-orange-500 mb-4">
                            ≈ûEKƒ∞L E≈ûLE≈ûTƒ∞RME
                        </h1>
                        <p className="text-2xl lg:text-3xl text-slate-600 mb-12">
                            Doƒüru ≈üekli bul!
                        </p>

                        <motion.button
                            whileHover={{ scale: 1.05 }}
                            whileTap={{ scale: 0.95 }}
                            onClick={onStart}
                            className="bg-gradient-to-r from-green-400 to-emerald-500 hover:from-green-500 hover:to-emerald-600 text-white text-4xl lg:text-5xl font-black py-8 px-16 lg:py-10 lg:px-20 rounded-full shadow-2xl min-h-[120px] min-w-[350px]"
                        >
                            üéÆ OYUNA BA≈ûLA
                        </motion.button>
                    </motion.div>
                </div>
            );
        };

        // Progress Bar Component
        const ProgressBar = ({ current, total }) => {
            const percentage = ((current - 1) / total) * 100;

            return (
                <div className="w-full px-4 lg:px-8">
                    <div className="h-5 lg:h-6 bg-slate-200 rounded-full overflow-hidden shadow-inner">
                        <motion.div
                            initial={{ width: 0 }}
                            animate={{ width: `${percentage}%` }}
                            transition={{ type: "spring", stiffness: 100, damping: 20 }}
                            className="h-full bg-gradient-to-r from-green-400 to-emerald-500 rounded-full"
                        />
                    </div>
                    <div className="text-center mt-2 text-lg lg:text-xl font-bold text-slate-600">
                        {current - 1} / {total} Tamamlandƒ±
                    </div>
                </div>
            );
        };

        // Shape Card Component (Flat Design - No Borders)
        const ShapeCard = ({ shape, onClick, isWrong, isShaking, disabled }) => {
            const baseSize = shape.isWide
                ? 'w-64 h-44 lg:w-72 lg:h-48 xl:w-80 xl:h-52'
                : 'w-44 h-44 lg:w-52 lg:h-52 xl:w-60 xl:h-60';

            return (
                <motion.button
                    initial={{ scale: 0, opacity: 0 }}
                    animate={{
                        scale: 1,
                        opacity: isWrong ? 0 : 1,
                    }}
                    transition={{
                        type: "spring",
                        stiffness: 300,
                        damping: 20,
                        opacity: { delay: isShaking ? 0.5 : 0, duration: 0.3 }
                    }}
                    whileTap={!disabled ? { scale: 0.9 } : {}}
                    className={`
                        relative flex items-center justify-center
                        ${baseSize}
                        m-3 lg:m-4 cursor-pointer
                        shape-shadow
                        ${!shape.clipPath ? shape.color : ''}
                        ${shape.type || ''}
                        ${isShaking ? 'shake-animation' : ''}
                        ${isWrong ? 'pointer-events-none' : ''}
                        ${disabled ? 'pointer-events-none' : ''}
                    `}
                    style={{ visibility: isWrong ? 'hidden' : 'visible' }}
                    onClick={onClick}
                    disabled={disabled || isWrong}
                >
                    {shape.clipPath && (
                        <div
                            className={`w-full h-full ${shape.color}`}
                            style={{ clipPath: shape.clipPath }}
                        />
                    )}
                </motion.button>
            );
        };

        // Reward Overlay Component
        const RewardOverlay = ({ onComplete }) => {
            useEffect(() => {
                const duration = 1500;
                const animationEnd = Date.now() + duration;
                const defaults = { startVelocity: 30, spread: 360, ticks: 60, zIndex: 100 };

                const interval = setInterval(() => {
                    const timeLeft = animationEnd - Date.now();
                    if (timeLeft <= 0) {
                        clearInterval(interval);
                        return;
                    }
                    const particleCount = 50 * (timeLeft / duration);
                    confetti({ ...defaults, particleCount, origin: { x: Math.random() * 0.4 + 0.1, y: Math.random() - 0.2 } });
                    confetti({ ...defaults, particleCount, origin: { x: Math.random() * 0.4 + 0.5, y: Math.random() - 0.2 } });
                }, 150);

                const timer = setTimeout(onComplete, 1500);
                return () => {
                    clearTimeout(timer);
                    clearInterval(interval);
                };
            }, [onComplete]);

            return (
                <motion.div
                    initial={{ scale: 0, opacity: 0 }}
                    animate={{ scale: 1, opacity: 1 }}
                    exit={{ scale: 0, opacity: 0 }}
                    className="fixed inset-0 flex items-center justify-center z-50 pointer-events-none"
                >
                    <motion.div
                        initial={{ scale: 0, rotate: -180 }}
                        animate={{ scale: 1, rotate: 0 }}
                        transition={{ type: "spring", stiffness: 200, damping: 15 }}
                        className="text-[180px] lg:text-[220px]"
                    >
                        ‚≠ê
                    </motion.div>
                </motion.div>
            );
        };

        // Main Game Component
        const Game = () => {
            const [gameStarted, setGameStarted] = useState(false);
            const [level, setLevel] = useState(1);
            const [score, setScore] = useState(0);
            const [currentQuestion, setCurrentQuestion] = useState(null);
            const [wrongAnswers, setWrongAnswers] = useState({});
            const [isCompleted, setIsCompleted] = useState(false);
            const [showReward, setShowReward] = useState(false);
            const [isTransitioning, setIsTransitioning] = useState(false);

            const handleStartGame = () => {
                initAudioContext();
                playStartSound();
                setGameStarted(true);
            };

            // Generate Question
            const generateQuestion = useCallback(() => {
                if (level > TOTAL_LEVELS) {
                    setIsCompleted(true);
                    fireEndConfetti();
                    return;
                }

                const numOptions = level <= 3 ? 2 : 3;
                const targetShape = SHAPES[Math.floor(Math.random() * SHAPES.length)];

                let options = [targetShape];
                while (options.length < numOptions) {
                    const randomShape = SHAPES[Math.floor(Math.random() * SHAPES.length)];
                    if (!options.find(o => o.id === randomShape.id)) {
                        options.push(randomShape);
                    }
                }

                options = options.sort(() => Math.random() - 0.5);

                setCurrentQuestion({
                    target: targetShape,
                    options: options
                });
                setWrongAnswers({});
                setIsTransitioning(false);

                setTimeout(() => {
                    speakInstruction(targetShape.displayName);
                }, 300);

            }, [level]);

            useEffect(() => {
                if (gameStarted && !isCompleted) {
                    generateQuestion();
                }
            }, [level, gameStarted, generateQuestion, isCompleted]);

            const handleOptionClick = (shape) => {
                if (isCompleted || isTransitioning || wrongAnswers[shape.id]?.isHidden) return;

                if (shape.id === currentQuestion.target.id) {
                    setIsTransitioning(true);
                    playCorrectSound();
                    setScore(s => s + 10);
                    setShowReward(true);
                } else {
                    playWrongSound();

                    setWrongAnswers(prev => ({
                        ...prev,
                        [shape.id]: { isShaking: true, isHidden: false }
                    }));

                    setTimeout(() => {
                        setWrongAnswers(prev => ({
                            ...prev,
                            [shape.id]: { isShaking: false, isHidden: true }
                        }));
                    }, 500);
                }
            };

            const handleRewardComplete = () => {
                setShowReward(false);
                setLevel(l => l + 1);
            };

            const fireEndConfetti = () => {
                const duration = 5 * 1000;
                const animationEnd = Date.now() + duration;
                const defaults = { startVelocity: 30, spread: 360, ticks: 100, zIndex: 0 };

                const interval = setInterval(() => {
                    const timeLeft = animationEnd - Date.now();

                    if (timeLeft <= 0) {
                        return clearInterval(interval);
                    }

                    const particleCount = 80 * (timeLeft / duration);
                    confetti({ ...defaults, particleCount, origin: { x: Math.random() * 0.3 + 0.1, y: Math.random() - 0.2 } });
                    confetti({ ...defaults, particleCount, origin: { x: Math.random() * 0.3 + 0.6, y: Math.random() - 0.2 } });
                }, 200);
            };

            const restartGame = () => {
                setLevel(1);
                setScore(0);
                setIsCompleted(false);
                setWrongAnswers({});
                setShowReward(false);
                setIsTransitioning(false);
            };

            // Start Screen
            if (!gameStarted) {
                return <StartScreen onStart={handleStartGame} />;
            }

            // End Game Screen
            if (isCompleted) {
                return (
                    <div className="flex flex-col items-center justify-center h-screen">
                        <motion.div
                            initial={{ scale: 0.5, opacity: 0 }}
                            animate={{ scale: 1, opacity: 1 }}
                            className="bg-white/90 backdrop-blur-sm p-10 lg:p-14 rounded-[3rem] shadow-2xl text-center max-w-3xl w-full mx-4"
                        >
                            <motion.div
                                initial={{ scale: 0 }}
                                animate={{ scale: 1 }}
                                transition={{ delay: 0.2, type: "spring" }}
                                className="text-7xl lg:text-8xl mb-4"
                            >
                                üéâ
                            </motion.div>
                            <h1 className="text-5xl lg:text-6xl font-black text-transparent bg-clip-text bg-gradient-to-r from-purple-600 to-pink-600 mb-4">
                                TEBRƒ∞KLER!
                            </h1>
                            <p className="text-xl lg:text-2xl text-slate-600 mb-6">Harika bir i≈ü √ßƒ±kardƒ±n!</p>
                            <div className="text-3xl lg:text-4xl font-bold text-orange-500 mb-8 bg-orange-50 py-3 px-6 rounded-2xl inline-block">
                                Toplam Puan: {score}
                            </div>
                            <br />
                            <button
                                onClick={restartGame}
                                className="bg-gradient-to-r from-green-400 to-emerald-500 hover:from-green-500 hover:to-emerald-600 text-white text-2xl lg:text-3xl font-bold py-5 px-12 rounded-full shadow-xl transform transition active:scale-95 mt-4"
                            >
                                Tekrar Oyna üîÑ
                            </button>
                        </motion.div>
                    </div>
                );
            }

            if (!currentQuestion) return null;

            return (
                <div className="flex flex-col h-screen max-h-screen">
                    {/* Reward Overlay */}
                    <AnimatePresence>
                        {showReward && <RewardOverlay onComplete={handleRewardComplete} />}
                    </AnimatePresence>

                    {/* Header / HUD */}
                    <header className="flex justify-between items-center p-3 lg:p-4 bg-white/80 backdrop-blur-sm shadow-sm z-10">
                        <a href="index.html" className="bg-slate-100 hover:bg-slate-200 text-slate-700 text-base lg:text-lg font-bold py-2 px-4 lg:px-5 rounded-xl transition">
                            üè† Ana Sayfa
                        </a>
                        <div className="text-xl lg:text-2xl font-bold text-orange-600 bg-orange-50 px-5 py-2 rounded-xl">
                            Puan: {score}
                        </div>
                    </header>

                    {/* Progress Bar */}
                    <div className="py-3 lg:py-4 bg-white/60">
                        <ProgressBar current={level} total={TOTAL_LEVELS} />
                    </div>

                    {/* Main Game Area */}
                    <main className="flex-1 flex flex-col items-center">

                        {/* Question Instruction */}
                        <div className="mt-6 lg:mt-10 mb-6 lg:mb-8 text-center">
                            <motion.h2
                                key={`${level}-${currentQuestion.target.name}`}
                                initial={{ y: -20, opacity: 0 }}
                                animate={{ y: 0, opacity: 1 }}
                                className="text-5xl lg:text-6xl xl:text-7xl font-black tracking-wide"
                            >
                                <span className="text-transparent bg-clip-text bg-gradient-to-r from-indigo-600 via-purple-600 to-pink-600">
                                    {currentQuestion.target.displayName.toUpperCase()}
                                </span>
                                <span className="text-slate-700 ml-2 lg:ml-3">BUL!</span>
                            </motion.h2>
                        </div>

                        {/* Options Grid */}
                        <div className="flex-1 w-full flex items-center justify-center pb-12 lg:pb-16">
                            <div className="flex flex-wrap justify-center items-center gap-6 lg:gap-10 xl:gap-12 max-w-6xl px-4">
                                {currentQuestion.options.map((shape, index) => (
                                    <ShapeCard
                                        key={`${level}-${shape.id}-${index}`}
                                        shape={shape}
                                        isWrong={wrongAnswers[shape.id]?.isHidden}
                                        isShaking={wrongAnswers[shape.id]?.isShaking}
                                        disabled={isTransitioning}
                                        onClick={() => handleOptionClick(shape)}
                                    />
                                ))}
                            </div>
                        </div>
                    </main>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<Game />);
    </script>
</body>

</html>